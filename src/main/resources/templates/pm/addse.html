<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>增加投票选项</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template."/>
    <meta name="author" content="Muhammad Usman"/>

    <!-- The styles -->
    <style type="text/css">
        body {
            padding-bottom: 40px;
        }
        .sidebar-nav {
            padding: 9px 0;
        }
        .centertwo{
            display: flex;display: -webkit-flex;flex-flow: column nowrap;justify-content: flex-start
        }
        .cdivpic{
            width: 80px;height: 80px;
        }
        .ctdiv1{
            display: flex;
            display: -webkit-flex;
            flex-flow: row nowrap;
            margin-left: 20px
        }
    </style>
    <link  href="/css/bootstrap-cerulean.css" rel="stylesheet"/>
    <link href="/css/bootstrap-responsive.css" rel="stylesheet"/>
    <link href="/css/charisma-app.css" rel="stylesheet"/>
    <link href="/css/jquery-ui-1.8.21.custom.css" rel="stylesheet"/>
    <link href='/css/fullcalendar.css' rel='stylesheet'/>
    <link href='/css/fullcalendar.print.css' rel='stylesheet'  media='print'/>
    <link href='/css/chosen.css' rel='stylesheet'/>
    <link href='/css/uniform.default.css' rel='stylesheet'/>
    <link href='/css/colorbox.css' rel='stylesheet'/>
    <link href='/css/jquery.cleditor.css' rel='stylesheet'/>
    <link href='/css/jquery.noty.css' rel='stylesheet'/>
    <link href='/css/noty_theme_default.css' rel='stylesheet'/>
    <link href='/css/elfinder.min.css' rel='stylesheet'/>
    <link href='/css/elfinder.theme.css' rel='stylesheet'/>
    <link href='/css/jquery.iphone.toggle.css' rel='stylesheet'/>
    <link href='/css/opa-icons.css' rel='stylesheet'/>
    <link href='/css/uploadify.css' rel='stylesheet'/>

    <!-- The HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- The fav icon -->
    <link rel="shortcut icon" href="/img/favicon.ico"/>

</head>

<body>
<!-- topbar starts -->
<div class="navbar">
    <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".top-nav.nav-collapse,.sidebar-nav.nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="index.html">  <span>智慧社区便民店</span></a>
            <div class="top-nav nav-collapse">
                欢迎你<span th:text="${session.user.nickname}"></span>
                <span id="neworder" style="font-size: 2em;color: red"></span>
            </div><!--/.nav-collapse -->
        </div>
    </div>
</div>
<!-- topbar ends -->
<!-- left menu starts -->
<div class="span2 main-menu-span">
    <div class="well nav-collapse sidebar-nav">
        <ul class="nav nav-tabs nav-stacked main-menu" th:each="mainfunction:${session.list}">
            <li class="nav-header hidden-tablet" th:text="${mainfunction.mainfunctionname}"></li>
            <ul class="nav nav-tabs nav-stacked main-menu" th:each="function:${mainfunction.functions}">
                <li class="nav-header hidden-tablet"><a th:href="@{${function.url}}" th:text="${function.functionname}"></a></li>
            </ul>
        </ul>
    </div><!--/.well -->
</div><!--/span-->

<!-- left menu ends -->


<div id="content" class="span10">
    <div id="gose">
        <input type="hidden" id="seid" th:value="${id}"/>
        <span>选项图标</span>
        <div><img name='tpic' style="width: 100px;height: 100px" id="uploadButton" src="/img/supermarket/上传图.png" /></div>
        <p>选项内容：<input type="text" name="content" id="content0" /></p>
    </div>
    <div>
        <p><button onclick="goon()">继续添加</button></p>
        <a href="javascript:void(0)" onclick="submitse()">添加</a><span id="spansubmit"></span>
    </div>
</div><!--/row-->

<script src="/js/qiniu.js"></script>
<!-- jQuery -->
<script src="/js/jquery-1.7.2.min.js"></script>
<!-- jQuery UI -->
<script src="/js/jquery-ui-1.8.21.custom.min.js"></script>
<!-- transition / effect library -->
<script src="/js/bootstrap-transition.js"></script>
<!-- alert enhancer library -->
<script src="/js/bootstrap-alert.js"></script>
<!-- modal / dialog library -->
<script src="/js/bootstrap-modal.js"></script>
<!-- custom dropdown library -->
<script src="/js/bootstrap-dropdown.js"></script>
<!-- scrolspy library -->
<script src="/js/bootstrap-scrollspy.js"></script>
<!-- library for creating tabs -->
<script src="/js/bootstrap-tab.js"></script>
<!-- library for advanced tooltip -->
<script src="/js/bootstrap-tooltip.js"></script>
<!-- popover effect library -->
<script src="/js/bootstrap-popover.js"></script>
<!-- button enhancer library -->
<script src="/js/bootstrap-button.js"></script>
<!-- accordion library (optional, not used in demo) -->
<script src="/js/bootstrap-collapse.js"></script>
<!-- carousel slideshow library (optional, not used in demo) -->
<script src="/js/bootstrap-carousel.js"></script>
<!-- autocomplete library -->
<script src="/js/bootstrap-typeahead.js"></script>
<!-- tour library -->
<script src="/js/bootstrap-tour.js"></script>
<!-- library for cookie management -->
<script src="/js/jquery.cookie.js"></script>
<!-- calander plugin -->
<script src='/js/fullcalendar.min.js'></script>
<!-- data table plugin -->
<script src='/js/jquery.dataTables.min.js'></script>

<!-- chart libraries start -->
<script src="/js/excanvas.js"></script>
<script src="/js/jquery.flot.min.js"></script>
<script src="/js/jquery.flot.pie.min.js"></script>
<script src="/js/jquery.flot.stack.js"></script>
<script src="/js/jquery.flot.resize.min.js"></script>
<!-- chart libraries end -->

<!-- select or dropdown enhancer -->
<script src="/js/jquery.chosen.min.js"></script>
<!-- checkbox, radio, and file input styler -->
<script src="/js/jquery.uniform.min.js"></script>
<!-- plugin for gallery image view -->
<script src="/js/jquery.colorbox.min.js"></script>
<!-- rich text editor library -->
<script src="/js/jquery.cleditor.min.js"></script>
<!-- notification plugin -->
<script src="/js/jquery.noty.js"></script>
<!-- file manager library -->
<script src="/js/jquery.elfinder.min.js"></script>
<!-- star rating plugin -->
<script src="/js/jquery.raty.min.js"></script>
<!-- for iOS style toggle switch -->
<script src="/js/jquery.iphone.toggle.js"></script>
<!-- autogrowing textarea plugin -->
<script src="/js/jquery.autogrow-textarea.js"></script>
<!-- multiple file upload plugin -->
<script src="/js/jquery.uploadify-3.1.min.js"></script>
<!-- history.js for cross-browser state change on ajax -->
<script src="/js/jquery.history.js"></script>
<!-- application script for Charisma demo -->
<script src="/js/Myother.js"></script>


<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function(){
        //themes, change CSS with JS
        //default theme(CSS) is cerulean, change it if needed
        var current_theme = $.cookie('current_theme')==null ? 'cerulean' :$.cookie('current_theme');
        switch_theme(current_theme);

        $('#themes a[data-value="'+current_theme+'"]').find('i').addClass('icon-ok');

        $('#themes a').click(function(e){
            e.preventDefault();
            current_theme=$(this).attr('data-value');
            $.cookie('current_theme',current_theme,{expires:365});
            switch_theme(current_theme);
            $('#themes i').removeClass('icon-ok');
            $(this).find('i').addClass('icon-ok');
        });


        function switch_theme(theme_name)
        {
            $('#bs-css').attr('href','css/bootstrap-'+theme_name+'.css');
        }

        //ajax menu checkbox
        $('#is-ajax').click(function(e){
            $.cookie('is-ajax',$(this).prop('checked'),{expires:365});
        });
        $('#is-ajax').prop('checked',$.cookie('is-ajax')==='true' ? true : false);

        //disbaling some functions for Internet Explorer
        if($.browser.msie)
        {
            $('#is-ajax').prop('checked',false);
            $('#for-is-ajax').hide();
            $('#toggle-fullscreen').hide();
            $('.login-box').find('.input-large').removeClass('span10');

        }


        //highlight current / active link
        $('ul.main-menu li a').each(function(){
            if($($(this))[0].href==String(window.location))
                $(this).parent().addClass('active');
        });

        //establish history variables
        var
            History = window.History, // Note: We are using a capital H instead of a lower h
            State = History.getState(),
            $log = $('#log');

        //bind to State Change
        History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
            var State = History.getState(); // Note: We are using History.getState() instead of event.state
            $.ajax({
                url:State.url,
                success:function(msg){
                    $('#content').html($(msg).find('#content').html());
                    $('#loading').remove();
                    $('#content').fadeIn();
                    var newTitle = $(msg).filter('title').text();
                    $('title').text(newTitle);
                    docReady();
                }
            });
        });

        //ajaxify menus
        $('a.ajax-link').click(function(e){
            if($.browser.msie) e.which=1;
            if(e.which!=1 || !$('#is-ajax').prop('checked') || $(this).parent().hasClass('active')) return;
            e.preventDefault();
            if($('.btn-navbar').is(':visible'))
            {
                $('.btn-navbar').click();
            }
            $('#loading').remove();
            $('#content').fadeOut().parent().append('<div id="loading" class="center">Loading...<div class="center"></div></div>');
            var $clink=$(this);
            History.pushState(null, null, $clink.attr('href'));
            $('ul.main-menu li.active').removeClass('active');
            $clink.parent('li').addClass('active');
        });

        //animating menus on hover
        $('ul.main-menu li:not(.nav-header)').hover(function(){
                $(this).animate({'margin-left':'+=5'},300);
            },
            function(){
                $(this).animate({'margin-left':'-=5'},300);
            });

        //other things to do on document ready, seperated for ajax calls
        docReady();


        //七牛上传文件
        var _token = null;

        $.ajax({
            url: '/muser/token',
            type: 'get',
            success: function (data) {
                _token = data;
                console.debug('A: ' + _token);
            }
        });


        // 上传空间URL
        var uploadSpace = 'http://osatg44gp.bkt.clouddn.com';

        qiniu.config({
            url: uploadSpace,
            uploadUrl: 'up-z2.qiniu.com' // 七牛统一的一个上传域名，固定
        });



            qiniu.bind($('#uploadButton'), {
                filter: 'image'
            }).on('file', function(file) {


                console.debug('---');

                var imagesBucket = qiniu.bucket('community', {
                    putToken: _token
                });

                console.debug('B: ' + _token);

                // 上传文件名
//                var fileName = 'abc_' + new Date().getMilliseconds() + '.jpg';

//                var fileName

                console.debug(file);

                var fileName = file.name;

                fileName = fileName+new Date().getMilliseconds();

//                    return;

                console.debug('文件名：'  + fileName);


                // Upload
                imagesBucket.putFile(fileName, file)
                    .then(
                        function(reply) {
                            // 上传成功
//                            console.dir(reply);
                            console.debug(reply.hash);
                            console.debug(reply.key);
                            var se = new Date().getMilliseconds();
//                          $('#result').html(uploadSpace + '/' + fileName + '?v=' + se);
                            $('#uploadButton').attr("src",uploadSpace + '/' + fileName + '?v=' + se);
                            $('#result').text(uploadSpace + '/' + fileName + '?v=' + se);
                            $('#hresult').val(uploadSpace + '/' + fileName + '?v=' + se)
                        },
                        function(err) {
                            // 上传失败
                            console.error(err);
                        }
                    );
            });

    });

    //上面是加载就启动js



    var count=0;
    function goon(){
        if(count<10){
            count++;
            $("#gose").append("" +
                "<span>选项图标</span>"+
                "<div><img name='tpic' id='uploadButton"+count+"' style='width:100px;height: 100px' src='/img/supermarket/上传图.png' /></div>"+
                "<p>选项内容：<input type='text' name='content' id='content"+count+"'/></p>")


            //七牛上传文件
            var _token = null;

            $.ajax({
                url: '/muser/token',
                type: 'get',
                success: function (data) {
                    _token = data;
                    console.debug('A: ' + _token);
                }
            });


            // 上传空间URL
            var uploadSpace = 'http://osatg44gp.bkt.clouddn.com';

            qiniu.config({
                url: uploadSpace,
                uploadUrl: 'up-z2.qiniu.com' // 七牛统一的一个上传域名，固定
            });



            qiniu.bind($('#uploadButton'+count), {
                filter: 'image'
            }).on('file', function(file) {


                console.debug('---');

                var imagesBucket = qiniu.bucket('community', {
                    putToken: _token
                });

                console.debug('B: ' + _token);

                // 上传文件名
//                var fileName = 'abc_' + new Date().getMilliseconds() + '.jpg';

//                var fileName

                console.debug(file);

                var fileName = file.name;

                fileName = fileName+new Date().getMilliseconds();

//                    return;

                console.debug('文件名：'  + fileName);


                // Upload
                imagesBucket.putFile(fileName, file)
                    .then(
                        function(reply) {
                            // 上传成功
//                            console.dir(reply);
                            console.debug(reply.hash);
                            console.debug(reply.key);
                            var se = new Date().getMilliseconds();
//                          $('#result').html(uploadSpace + '/' + fileName + '?v=' + se);
                            $('#uploadButton'+count).attr("src",uploadSpace + '/' + fileName + '?v=' + se);
                            $('#result').text(uploadSpace + '/' + fileName + '?v=' + se);
                            $('#hresult').val(uploadSpace + '/' + fileName + '?v=' + se)
                        },
                        function(err) {
                            // 上传失败
                            console.error(err);
                        }
                    );
            });

        }else{
            alert("不能添加超过十个选项")
            return true;
        }
    }

    function submitse(){
        var contents=$("[name='content']");
        var tpic=$("[name='tpic']");
        var path="";
        for(var k=0;k<tpic.length;k++){
            if(k==0){
                path=path+$(tpic[k]).attr("src");
            }else{
               path=path+","+ $(tpic[k]).attr("src");
            }
        }
        var id=$("#seid").val();
        var content="";
        for(var i=0;i<contents.length;i++){
            if(i==0){
                content=content+$("#content"+i).val();
            }else{
                content=content+","+$("#content"+i).val();
            }
        }
        window.location.href="/pm/addse?id="+id+"&content="+content+"&path="+path;
    }
    /*]]>*/
</script>


</body>
</html>
